<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiveIn - Cadastre-se</title>
    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="./css/cadastro.css">
</head>
<header>
    <div class="menu">
        <div class="opcoesL">
            <img src="./assets/logo.png" alt="Logotipo DiveIn">
            <a href="index.html" class="normal">INICIO</a>
            <a href="sobre.html" class="normal">SOBRE O MERGULHADOR</a>
        </div>
        <div class="opcoesR">
            <a href="cadastro.html" class="normal">CADASTRE-SE</a>
            <a href="entrar.html" class="inOut">ENTRAR</a>
        </div>
    </div>
</header>

<body>
    <div class="container">
        <div class="text">
            <h1>CADASTRO</h1>
            <p>Nome</p>
            <input type="text" onkeyup="verificarNome()" placeholder="Digite seu nome" id="iptNome">
            <i class="textError" id="erroNome"></i>
            <p>Sobrenome</p>
            <input type="text" onkeyup="verificarSobrenome()" placeholder="Digite seu sobrenome" id="iptSobrenome">
            <i class="textError" id="erroSobrenome"></i>
            <p>E-mail</p>
            <input type="text" onkeyup="verificarEmail()" placeholder="Digite seu e-mail" id="iptEmail">
            <i class="textError" id="erroEmail"></i>
            <p>Senha</p>
            <input type="password" onkeyup="verificarSenha()" placeholder="Digite sua senha" id="iptSenha">
            <i class="textError" id="erroSenha"></i>
            <p>Repetir senha</p>
            <input type="password" onkeyup="verificarRepetir()" placeholder="Repita sua senha" id="iptRepetirSenha">
            <i class="textError" id="erroRepetir"></i>
            <button onclick="cadastrar()">CADASTRAR</button>
        </div>
    </div>
</body>
<script>
    let validarNome = false;
    let validarSobrenome = false;
    let validarEmail = false;
    let validarSenha = false;
    let validarRepetir = false;
    function verificarNome() {
        let nome = iptNome.value;
        if (nome.length <= 2 || nome == '') {
            erroNome.innerHTML = 'Insira um nome';
        } else {
            erroNome.innerHTML = '';
            validarNome = true;
        }
    }
    function verificarSobrenome() {
        let sobrenome = iptSobrenome.value;
        if (sobrenome.length <= 2 || sobrenome == '') {
            erroSobrenome.innerHTML = 'Insira um sobrenome';
        } else {
            erroSobrenome.innerHTML = '';
            validarSobrenome = true;
        }
    }
    function verificarEmail() {
        let email = iptEmail.value;
        for (let i = 0; i < email.length; i++) {
            if (email.includes('@') && email.includes('.com')) {
                validarEmail = true;
                erroEmail.innerHTML = '';
            } else {
                erroEmail.innerHTML = 'Preencha com um email válido';
            }
        }
    }
    function verificarSenha() {
        let senha = iptSenha.value;
        let validarMaiuscula = false;
        let validarMinuscula = false;
        let validarNumero = false;
        let validarEspecial = false;
        let maiuscula = ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P",
            "A", "S", "D", "F", "G", "H", "J", "K", "L", "Ç", "Z", "X",
            "C", "V", "B", "N", "M"];
        let minuscula = ["q", "w", "e", "r", "t", "y", "u", "i", "o", "p",
            "a", "s", "d", "f", "g", "h", "j", "k", "l", "ç", "z", "x",
            "c", "v", "b", "n", "m"];
        let numero = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
        let especial = ["!", "@", "_", "$", "%", "&", "*", ".", "/",
            "#", "?"];
        for (let i = 0; i < maiuscula.length; i++) {
            if (senha.includes(maiuscula[i])) {
                validarMaiuscula = true;
                break;
            }
        }
        for (let i = 0; i < minuscula.length; i++) {
            if (senha.includes(minuscula[i])) {
                validarMinuscula = true;
                break;
            }
        }
        for (let i = 0; i < numero.length; i++) {
            if (senha.includes(numero[i])) {
                validarNumero = true;
                break;
            }
        }
        for (let i = 0; i < especial.length; i++) {
            if (senha.includes(especial[i])) {
                validarEspecial = true;
                break;
            }
        }
        if (validarMaiuscula && validarMinuscula && validarNumero && validarEspecial) {
            validarSenha = true;
            erroSenha.innerHTML = '';
        } else {
            erroSenha.innerHTML = 'Deve conter 8 caracteres ou mais, 1 letra maiúscula, 1 letra minúscula, 1 numero e 1 caracter especial';
        }
    }
    function verificarRepetir() {
        if (iptSenha.value == iptRepetirSenha.value) {
            validarRepetir = true;
            erroRepetir.innerHTML = '';
        } else {
            erroRepetir.innerHTML = 'As senhas devem ser iguais';
        }
    }
    function cadastrar() {
        if (validarNome && validarSobrenome && validarEmail && validarSenha && validarRepetir) {
            var nome = iptNome.value;
            var sobrenome = iptSobrenome.value;
            var email = iptEmail.value;
            var senha = iptSenha.value;

            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nome,
                    sobrenomeServer: sobrenome,
                    emailServer: email,
                    senhaServer: senha
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        setTimeout(() => {
                            window.location = "entrar.html";
                        }, "500");
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
            return false;
        }
    } 
</script>

</html>